{
  "openapi": "3.1.0",
  "info": {
    "title": "kling-v3-text-to-video接口",
    "description": "使用AI模型创建文生视频任务",
    "license": { "name": "MIT" },
    "version": "1.0.0"
  },
  "servers": [
    { "url": "https://api.evolink.ai", "description": "生产环境" }
  ],
  "security": [{ "bearerAuth": [] }],
  "paths": {
    "/v1/videos/generations": {
      "post": {
        "summary": "kling-v3-text-to-video接口",
        "description": "- Kling-V3 Text to Video (kling-v3-text-to-video) 模型支持文生视频功能\n- 支持单镜头和多镜头模式，可生成带音效的视频\n- 异步处理模式，使用返回的任务ID [进行查询](/cn/api-manual/task-management/get-task-detail)\n- 生成的视频链接，有效期为24小时，请尽快保存",
        "operationId": "createVideoGeneration",
        "tags": ["视频生成"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/VideoGenerationRequest" },
              "examples": {
                "basic": {
                  "summary": "基础文生视频",
                  "value": {
                    "model": "kling-v3-text-to-video",
                    "prompt": "一只猫在草地上奔跑，阳光明媚",
                    "duration": 5,
                    "aspect_ratio": "16:9",
                    "quality": "720p"
                  }
                },
                "pro_with_sound": {
                  "summary": "1080P 带音效",
                  "value": {
                    "model": "kling-v3-text-to-video",
                    "prompt": "暴风雨中的海浪拍打岩石，雷声隆隆",
                    "duration": 10,
                    "aspect_ratio": "16:9",
                    "quality": "1080p",
                    "sound": "on"
                  }
                },
                "multi_shot": {
                  "summary": "多镜头（自定义分镜）",
                  "value": {
                    "model": "kling-v3-text-to-video",
                    "duration": 10,
                    "aspect_ratio": "16:9",
                    "quality": "1080p",
                    "sound": "on",
                    "model_params": {
                      "multi_shot": true,
                      "shot_type": "customize",
                      "multi_prompt": [
                        { "index": 1, "prompt": "一个人站在山顶远眺日出", "duration": "5" },
                        { "index": 2, "prompt": "镜头拉远，展现壮阔山景全貌", "duration": "5" }
                      ]
                    }
                  }
                },
                "negative_prompt": {
                  "summary": "带负向提示词",
                  "value": {
                    "model": "kling-v3-text-to-video",
                    "prompt": "一片宁静的湖泊，远处有山脉",
                    "negative_prompt": "人物、文字、水印",
                    "duration": 5,
                    "aspect_ratio": "16:9",
                    "quality": "1080p"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "视频生成任务创建成功",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/VideoGenerationResponse" }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" },
                "example": { "error": { "code": 400, "message": "Invalid request parameter", "type": "invalid_request_error" } }
              }
            }
          },
          "401": {
            "description": "未认证、Token无效或过期",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" },
                "example": { "error": { "code": 401, "message": "Invalid or expired token", "type": "authentication_error" } }
              }
            }
          },
          "402": {
            "description": "配额不足、需要充值",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" },
                "example": { "error": { "code": 402, "message": "Insufficient quota", "type": "insufficient_quota_error", "fallback_suggestion": "https://evolink.ai/dashboard/billing" } }
              }
            }
          },
          "403": {
            "description": "无权限访问",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" },
                "example": { "error": { "code": 403, "message": "Access denied for this model", "type": "permission_error", "param": "model" } }
              }
            }
          },
          "404": {
            "description": "资源不存在",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" },
                "example": { "error": { "code": 404, "message": "Specified model not found", "type": "not_found_error", "param": "model", "fallback_suggestion": "kling-v3-text-to-video" } }
              }
            }
          },
          "429": {
            "description": "请求频率超限",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" },
                "example": { "error": { "code": 429, "message": "Rate limit exceeded", "type": "rate_limit_error", "fallback_suggestion": "retry after 60 seconds" } }
              }
            }
          },
          "500": {
            "description": "服务器内部错误",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" },
                "example": { "error": { "code": 500, "message": "Internal server error", "type": "internal_server_error", "fallback_suggestion": "try again later" } }
              }
            }
          },
          "502": {
            "description": "上游服务错误",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" },
                "example": { "error": { "code": 502, "message": "Upstream AI service unavailable", "type": "upstream_error", "fallback_suggestion": "try different model" } }
              }
            }
          },
          "503": {
            "description": "服务暂时不可用",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" },
                "example": { "error": { "code": 503, "message": "Service temporarily unavailable", "type": "service_unavailable_error", "fallback_suggestion": "retry after 30 seconds" } }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "VideoGenerationRequest": {
        "type": "object",
        "required": ["model", "prompt"],
        "properties": {
          "model": {
            "type": "string",
            "description": "视频生成模型名称",
            "enum": ["kling-v3-text-to-video"],
            "default": "kling-v3-text-to-video",
            "example": "kling-v3-text-to-video"
          },
          "prompt": {
            "type": "string",
            "description": "文本提示词，描述想要生成什么样的视频\n\n**注意：**\n- 最长`2500`字符\n- `multi_shot=true` 且 `shot_type=customize` 时可空（由 `multi_prompt` 提供各分镜内容）\n- `multi_shot=false` 或 `shot_type=intelligence` 时**必填**",
            "example": "一只猫在草地上奔跑，阳光明媚",
            "maxLength": 2500
          },
          "negative_prompt": {
            "type": "string",
            "description": "负向提示词，描述不想在视频中出现的内容",
            "example": "人物、文字、水印"
          },
          "duration": {
            "type": "integer",
            "description": "视频时长（秒），默认为`5`秒\n\n**说明：**\n- 范围：`3` ~ `15` 的整数\n- 单次请求会根据`duration`的值进行扣费，时长越长价格越高",
            "minimum": 3,
            "maximum": 15,
            "default": 5,
            "example": 5
          },
          "aspect_ratio": {
            "type": "string",
            "description": "视频宽高比\n\n**说明：**\n- `16:9`：横屏视频\n- `9:16`：竖屏视频\n- `1:1`：方形视频",
            "enum": ["16:9", "9:16", "1:1"],
            "example": "16:9"
          },
          "quality": {
            "type": "string",
            "description": "分辨率档位\n\n**说明：**\n- `720p`：标准画质（std）\n- `1080p`：高品质画质（pro）",
            "enum": ["720p", "1080p"],
            "default": "720p",
            "example": "720p"
          },
          "sound": {
            "type": "string",
            "description": "音效控制\n\n**说明：**\n- `on`：生成音效\n- `off`：无音效",
            "enum": ["on", "off"],
            "default": "off",
            "example": "off"
          },
          "model_params": {
            "type": "object",
            "description": "高级参数，用于多镜头和水印控制",
            "properties": {
              "multi_shot": {
                "type": "boolean",
                "description": "是否启用多镜头模式\n\n**说明：**\n- `true`：多镜头模式，需配合 `shot_type` 使用\n- `false`：单镜头模式（默认）",
                "default": false,
                "example": false
              },
              "shot_type": {
                "type": "string",
                "description": "分镜方式，`multi_shot=true` 时**必填**\n\n**说明：**\n- `customize`：自定义分镜，需提供 `multi_prompt`\n- `intelligence`：智能分镜，由模型自动分镜",
                "enum": ["customize", "intelligence"],
                "example": "customize"
              },
              "multi_prompt": {
                "type": "array",
                "description": "各分镜信息，`multi_shot=true` 且 `shot_type=customize` 时**必填**\n\n**注意：**\n- 最多`6`个分镜，最少`1`个\n- 每个分镜 prompt 最长`512`字符\n- 每个分镜 duration ≥ 1 且 ≤ 总时长\n- **所有分镜的 duration 之和必须等于总任务的 duration**",
                "items": {
                  "type": "object",
                  "properties": {
                    "index": { "type": "integer", "description": "分镜序号，从1开始" },
                    "prompt": { "type": "string", "description": "该分镜的文本描述", "maxLength": 512 },
                    "duration": { "type": "string", "description": "该分镜的时长（秒）" }
                  },
                  "required": ["index", "prompt", "duration"]
                },
                "minItems": 1,
                "maxItems": 6
              },
              "watermark_info": {
                "type": "object",
                "description": "水印配置",
                "properties": {
                  "enabled": { "type": "boolean", "description": "是否启用水印" }
                }
              }
            }
          },
          "callback_url": {
            "type": "string",
            "description": "任务完成后的HTTPS回调地址\n\n**回调时机：**\n- 任务完成（completed）、失败（failed）或取消（cancelled）时触发\n- 在计费确认完成后发送\n\n**安全限制：**\n- 仅支持HTTPS协议\n- 禁止回调到内网IP地址（127.0.0.1、10.x.x.x、172.16-31.x.x、192.168.x.x等）\n- URL长度不超过`2048`字符\n\n**回调机制：**\n- 超时时间：`10`秒\n- 失败后最多重试`3`次（会分别在失败的`1`秒/`2`秒/`4`秒后进行重试）\n- 回调响应体格式与任务查询接口返回的格式一致\n- 回调地址若返回2xx状态码视为成功，其他状态码会触发重试",
            "format": "uri",
            "example": "https://your-domain.com/webhooks/video-task-completed"
          }
        }
      },
      "VideoGenerationResponse": {
        "type": "object",
        "properties": {
          "created": { "type": "integer", "description": "任务创建时间戳", "example": 1757169743 },
          "id": { "type": "string", "description": "任务ID", "example": "task-unified-1757169743-7cvnl5zw" },
          "model": { "type": "string", "description": "实际使用的模型名称", "example": "kling-v3-text-to-video" },
          "object": { "type": "string", "enum": ["video.generation.task"], "description": "任务的具体类型" },
          "progress": { "type": "integer", "description": "任务进度百分比 (0-100)", "minimum": 0, "maximum": 100, "example": 0 },
          "status": { "type": "string", "description": "任务状态", "enum": ["pending", "processing", "completed", "failed"], "example": "pending" },
          "task_info": { "$ref": "#/components/schemas/VideoTaskInfo", "description": "视频任务详细信息" },
          "type": { "type": "string", "enum": ["text", "image", "audio", "video"], "description": "任务的输出类型", "example": "video" },
          "usage": { "$ref": "#/components/schemas/VideoUsage", "description": "使用量和计费信息" }
        }
      },
      "VideoTaskInfo": {
        "type": "object",
        "properties": {
          "can_cancel": { "type": "boolean", "description": "任务是否可以取消", "example": true },
          "estimated_time": { "type": "integer", "description": "预估完成时间(秒)", "minimum": 0, "example": 300 },
          "video_duration": { "type": "integer", "description": "视频时长(秒)", "example": 5 }
        }
      },
      "VideoUsage": {
        "type": "object",
        "description": "使用量和计费信息",
        "properties": {
          "billing_rule": { "type": "string", "description": "计费规则", "enum": ["per_call", "per_token", "per_second"], "example": "per_second" },
          "credits_reserved": { "type": "number", "description": "预估消耗积分数", "minimum": 0, "example": 270000 },
          "user_group": { "type": "string", "description": "用户组类别", "example": "default" }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "object",
            "properties": {
              "code": { "type": "integer", "description": "HTTP状态错误代码" },
              "message": { "type": "string", "description": "错误描述信息", "example": "请求参数错误" },
              "type": { "type": "string", "description": "错误类型", "example": "invalid_request_error" },
              "param": { "type": "string", "description": "相关参数名称", "example": "model" },
              "fallback_suggestion": { "type": "string", "description": "错误时的建议", "example": "kling-v3-text-to-video" }
            }
          }
        }
      }
    },
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "description": "##所有接口均需要使用Bearer Token进行认证##\n\n**获取 API Key：**\n\n访问 [API Key 管理页面](https://evolink.ai/dashboard/keys) 获取您的 API Key\n\n**使用时在请求头中添加：**\n```\nAuthorization: Bearer YOUR_API_KEY\n```"
      }
    }
  },
  "tags": [
    { "name": "视频生成", "description": "AI视频生成相关接口" }
  ]
}
